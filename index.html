<html>
	<div id="token"></div>
	<script type="text/javascript" src="jquery-3.1.1.js"></script>
	<script type="text/javascript"></script>
	<script  type="text/javascript" src="https://www.gstatic.com/firebasejs/4.2.0/firebase.js"></script>
	<script  type="text/javascript">
		
		var config = {
                apiKey: "AIzaSyAZM-FlQNjcyHlRdnaK6gvpogs7JyhTR2w",
                authDomain: "testfirefoxpush.firebaseapp.com",
                databaseURL: "https://testfirefoxpush.firebaseio.com",
                projectId: "testfirefoxpush",
                storageBucket: "testfirefoxpush.appspot.com",
                 messagingSenderId: "677094341418"
        };
    firebase.initializeApp(config);

		//инициализируем подключение к FCM
		firebase.initializeApp(config);
		const messaging = firebase.messaging();
		document.getElementById('token').innerHTML = 'NO LOAD TOKEN';
 
		//запрос на показ Web-PUSH браузеру
		messaging.requestPermission()
		.then(function() {
			console.log('Notification permission granted.');
			// Если нотификация разрешена, получаем токен.
			messaging.getToken()
			.then(function(currentToken) {
				if (currentToken) {
					console.log(currentToken);
					//отправка токена на сервер
					SendTokenToServer(currentToken);
					document.getElementById('token').innerHTML = currentToken;
				} else {
					console.log('No Instance ID token available. Request permission to generate one.');
				}
			})
			.catch(function(err) {
				console.log('An error occurred while retrieving token. ', err);
				showToken('Error retrieving Instance ID token. ', err);
			});
			// ...
		})
		.catch(function(err) {
			console.log('Unable to get permission to notify.', err);
		});
 
		/*
		//обновление токена
		messaging.onTokenRefresh(function() {
			messaging.getToken()
			.then(function(refreshedToken) {
				console.log('Token refreshed.');
			})
			.catch(function(err) {
				console.log('Unable to retrieve refreshed token ', err);
				showToken('Unable to retrieve refreshed token ', err);
			});
		}) */
 
		//окно sw
		messaging.onMessage(function(payload) {
			console.log('Message received. ', payload);
			// регистрируем пустой ServiceWorker каждый раз
			navigator.serviceWorker.register('firebase-messaging-sw.js');
			// запрашиваем права на показ уведомлений если еще не получили их
			Notification.requestPermission(function(result) {
				if (result === 'granted') {
					navigator.serviceWorker.ready.then(function(registration) {
						// теперь мы можем показать уведомление
						return registration.showNotification(payload.notification.title, payload.notification);
					}).catch(function(error) {
						console.log('ServiceWorker registration failed', error);
					});
				}
			});
		});
        </script>
    <h1>test</h1>
</html>